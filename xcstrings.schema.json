{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://example.com/xcstrings.schema.json",
    "title": "XCStrings Catalog",
    "type": "object",
    "additionalProperties": false,
    "required": [
        "version",
        "sourceLanguage",
        "strings"
    ],
    "properties": {
        "formatVersion": {
            "type": [
                "string",
                "integer"
            ],
            "description": "Optional format version emitted by some tooling."
        },
        "version": {
            "type": "string",
            "pattern": "^\\d+\\.\\d+$"
        },
        "sourceLanguage": {
            "type": "string",
            "pattern": "^[A-Za-z]{2}(-[A-Za-z0-9]+)*$"
        },
        "strings": {
            "type": "object",
            "minProperties": 1,
            "additionalProperties": {
                "$ref": "#/$defs/stringEntry"
            }
        }
    },
    "$defs": {
        "stringEntry": {
            "type": "object",
            "properties": {
                "comment": {
                    "type": "string"
                },
                "extractionState": {
                    "type": "string",
                    "enum": [
                        "manual",
                        "stale",
                        "extracted"
                    ]
                },
                "shouldTranslate": {
                    "type": "boolean"
                },
                "localizations": {
                    "type": "object",
                    "minProperties": 1,
                    "additionalProperties": false,
                    "patternProperties": {
                        "^[A-Za-z]{2}(-[A-Za-z0-9]+)*$": {
                            "$ref": "#/$defs/localization"
                        }
                    }
                }
            },
            "additionalProperties": false
        },
        "localization": {
            "type": "object",
            "properties": {
                "stringUnit": {
                    "$ref": "#/$defs/stringUnit"
                },
                "variations": {
                    "$ref": "#/$defs/variationSet"
                },
                "substitutions": {
                    "type": "object",
                    "minProperties": 1,
                    "additionalProperties": {
                        "$ref": "#/$defs/substitution"
                    }
                }
            },
            "additionalProperties": false,
            "anyOf": [
                {
                    "required": [
                        "stringUnit"
                    ]
                },
                {
                    "required": [
                        "variations"
                    ]
                }
            ]
        },
        "stringUnit": {
            "type": "object",
            "required": [
                "state",
                "value"
            ],
            "properties": {
                "state": {
                    "type": "string",
                    "enum": [
                        "translated",
                        "needs_review",
                        "new",
                        "missing",
                        "untranslated"
                    ]
                },
                "value": {
                    "type": "string"
                }
            },
            "additionalProperties": false
        },
        "variationSet": {
            "type": "object",
            "minProperties": 1,
            "propertyNames": {
                "pattern": "^[A-Za-z_][A-Za-z0-9_-]*$"
            },
            "additionalProperties": {
                "$ref": "#/$defs/variationAxis"
            },
            "allOf": [
                {
                    "if": {
                        "required": [
                            "plural"
                        ]
                    },
                    "then": {
                        "properties": {
                            "plural": {
                                "$ref": "#/$defs/pluralVariationAxis"
                            }
                        }
                    }
                },
                {
                    "if": {
                        "required": [
                            "device"
                        ]
                    },
                    "then": {
                        "properties": {
                            "device": {
                                "$ref": "#/$defs/deviceVariationAxis"
                            }
                        }
                    }
                },
                {
                    "not": {
                        "allOf": [
                            {
                                "required": [
                                    "plural"
                                ]
                            },
                            {
                                "required": [
                                    "device"
                                ]
                            }
                        ]
                    }
                }
            ]
        },
        "variationValue": {
            "type": "object",
            "properties": {
                "stringUnit": {
                    "$ref": "#/$defs/stringUnit"
                },
                "variations": {
                    "$ref": "#/$defs/variationSet"
                },
                "substitutions": {
                    "type": "object",
                    "minProperties": 1,
                    "additionalProperties": {
                        "$ref": "#/$defs/substitution"
                    }
                }
            },
            "additionalProperties": false,
            "anyOf": [
                {
                    "required": [
                        "stringUnit"
                    ]
                },
                {
                    "required": [
                        "variations"
                    ]
                }
            ]
        },
        "pluralVariationValue": {
            "type": "object",
            "properties": {
                "stringUnit": {
                    "$ref": "#/$defs/stringUnit"
                },
                "variations": {
                    "$ref": "#/$defs/pluralNestedVariationSet"
                },
                "substitutions": {
                    "type": "object",
                    "minProperties": 1,
                    "additionalProperties": {
                        "$ref": "#/$defs/substitution"
                    }
                }
            },
            "additionalProperties": false,
            "anyOf": [
                {
                    "required": [
                        "stringUnit"
                    ]
                },
                {
                    "required": [
                        "variations"
                    ]
                }
            ]
        },
        "deviceVariationValue": {
            "type": "object",
            "properties": {
                "stringUnit": {
                    "$ref": "#/$defs/stringUnit"
                },
                "variations": {
                    "$ref": "#/$defs/deviceNestedVariationSet"
                },
                "substitutions": {
                    "type": "object",
                    "minProperties": 1,
                    "additionalProperties": {
                        "$ref": "#/$defs/substitution"
                    }
                }
            },
            "additionalProperties": false,
            "anyOf": [
                {
                    "required": [
                        "stringUnit"
                    ]
                },
                {
                    "required": [
                        "variations"
                    ]
                }
            ]
        },
        "pluralNestedVariationSet": {
            "type": "object",
            "minProperties": 1,
            "propertyNames": {
                "pattern": "^[A-Za-z_][A-Za-z0-9_-]*$"
            },
            "additionalProperties": {
                "$ref": "#/$defs/variationAxis"
            },
            "not": {
                "required": [
                    "device"
                ]
            }
        },
        "deviceNestedVariationSet": {
            "type": "object",
            "minProperties": 1,
            "propertyNames": {
                "pattern": "^[A-Za-z_][A-Za-z0-9_-]*$"
            },
            "additionalProperties": {
                "$ref": "#/$defs/variationAxis"
            },
            "allOf": [
                {
                    "if": {
                        "required": [
                            "plural"
                        ]
                    },
                    "then": {
                        "properties": {
                            "plural": {
                                "$ref": "#/$defs/pluralVariationAxis"
                            }
                        }
                    }
                },
                {
                    "not": {
                        "required": [
                            "device"
                        ]
                    }
                }
            ]
        },
        "substitution": {
            "type": "object",
            "properties": {
                "formatSpecifier": {
                    "type": "string",
                    "enum": [
                        "@",
                        "ld",
                        "lld",
                        "llu",
                        "lf"
                    ]
                },
                "argNum": {
                    "type": "integer",
                    "minimum": 0
                },
                "stringUnit": {
                    "$ref": "#/$defs/stringUnit"
                },
                "variations": {
                    "$ref": "#/$defs/variationSet"
                }
            },
            "additionalProperties": false,
            "anyOf": [
                {
                    "required": [
                        "stringUnit"
                    ]
                },
                {
                    "required": [
                        "variations"
                    ]
                }
            ]
        },
        "variationAxis": {
            "type": "object",
            "minProperties": 1,
            "propertyNames": {
                "pattern": "^[A-Za-z0-9_-]+$"
            },
            "additionalProperties": {
                "$ref": "#/$defs/variationValue"
            }
        },
        "pluralVariationAxis": {
            "type": "object",
            "minProperties": 1,
            "propertyNames": {
                "enum": [
                    "zero",
                    "one",
                    "two",
                    "few",
                    "many",
                    "other"
                ]
            },
            "additionalProperties": {
                "$ref": "#/$defs/pluralVariationValue"
            }
        },
        "deviceVariationAxis": {
            "type": "object",
            "minProperties": 1,
            "propertyNames": {
                "enum": [
                    "appletv",
                    "applevision",
                    "applewatch",
                    "ipad",
                    "iphone",
                    "ipod",
                    "mac",
                    "other"
                ]
            },
            "additionalProperties": {
                "$ref": "#/$defs/deviceVariationValue"
            }
        }
    }
}
